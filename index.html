<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title>Guitar Chords</title>
</head>
<body id="body">
    <div class="d-flex justify-content-evenly flex-wrap align-items-center m-4">
        <div class="m-2 btn-group" role="group" aria-label="Basic example">
            <button type="button" class="p-4 btn btn-primary btn-lg" data-note='c.mp3' onclick="play('c.mp3')">C</button>
            <button type="button" class="p-4 btn btn-primary btn-lg" data-note='c-minor.mp3' onclick="play('c-minor.mp3')">c</button>
          </div>
        <div class="m-2 btn-group" role="group" aria-label="Basic example">
            <button type="button" class="p-4 btn btn-primary btn-lg" data-note='d.mp3' onclick="play('d.mp3')">D</button>
            <button type="button" class="p-4 btn btn-primary btn-lg" data-note='d-minor.mp3' onclick="play('d-minor.mp3')">d</button>
          </div>
        <div class="m-2 btn-group" role="group" aria-label="Basic example">
            <button type="button" class="p-4 btn btn-primary btn-lg" data-note='e.mp3' onclick="play('e.mp3')">E</button>
            <button type="button" class="p-4 btn btn-primary btn-lg" data-note='e-minor.mp3' onclick="play('e-minor.mp3')">e</button>
          </div>
        <div class="m-2 btn-group" role="group" aria-label="Basic example">
            <button type="button" class="p-4 btn btn-primary btn-lg" data-note='f.mp3' onclick="play('f.mp3')">F</button>
            <button type="button" class="p-4 btn btn-primary btn-lg" data-note='f-minor.mp3' onclick="play('f-minor.mp3')">f</button>
          </div>
        <div class="m-2 btn-group" role="group" aria-label="Basic example">
            <button type="button" class="p-4 btn btn-primary btn-lg" data-note='g.mp3' onclick="play('g.mp3')">G</button>
            <button type="button" class="p-4 btn btn-primary btn-lg" data-note='g-minor.mp3' onclick="play('g-minor.mp3')">g</button>
          </div>
        <div class="m-2 btn-group" role="group" aria-label="Basic example">
            <button type="button" class="p-4 btn btn-primary btn-lg" data-note='a.mp3' onclick="play('a.mp3')">A</button>
            <button type="button" class="p-4 btn btn-primary btn-lg" data-note='a-minor.mp3' onclick="play('a-minor.mp3')">a</button>
          </div>
        <div class="m-2 btn-group" role="group" aria-label="Basic example">
            <button type="button" class="p-4 btn btn-primary btn-lg" data-note='b.mp3' onclick="play('b.mp3')">B</button>
            <button type="button" class="p-4 btn btn-primary btn-lg" data-note='b-minor.mp3' onclick="play('b-minor.mp3')">b</button>
          </div>
    </div>

    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script>
        var noteURLs = {};
        var noteTones = {};
        files = ['c.mp3','c-minor.mp3','d.mp3','d-minor.mp3','e.mp3','e-minor.mp3','f.mp3','f-minor.mp3','g.mp3','g-minor.mp3','a.mp3','a-minor.mp3','b.mp3','b-minor.mp3']

        function Channel(audio_uri) {
            this.audio_uri = audio_uri;
            this.resource = new Audio(audio_uri);
        }
        Channel.prototype.play = function() {
            // Try refreshing the resource altogether
            this.resource.play();
        }

        function Switcher(audio_uri, num) {
            this.channels = [];
            this.num = num;
            this.index = 0;

            for (var i = 0; i < num; i++) {
                this.channels.push(new Channel(audio_uri));
            }
        }
        Switcher.prototype.play = function() {
            this.channels[this.index++].play();
            this.index = this.index < this.num ? this.index : 0;
        }

        // fetch audio files
        async function getUrl(file){
            fetch(`https://paramSonawane.github.io/GuitarNotes/assets/${file}`)
            .then((response) => {
                reader = response.body.getReader();
                reader.read()
                .then((result) => {
                    blob = new Blob([result.value], { type: 'audio/mp3' });
                    url = window.URL.createObjectURL(blob)
                })
                .then(()=>{
                    noteURLs[file] = url
                    noteTones[file] = new Switcher(url, 5)
                })
            })
        }
        // create a local url dict for faster notes
        for (index in files){
            noteTones[files[index]] = new Switcher(`./assets/${files[index]}`, 5)
            // getUrl(files[index])
        }

        function play(key){
            file_name = key
            noteTones[file_name].play()
        }
    </script>
</body>
</html>
